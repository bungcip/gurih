// Employee Status Transitions defined using standard workflow syntax

workflow "PegawaiStatusWorkflow" for="Pegawai" field="status_pegawai" {
    state "CPNS" initial="true"
    state "PNS"
    state "Pensiun" immutable="true"
    state "Cuti"
    state "TugasBelajar"
    state "Nonaktif"
    state "Pindah"

    transition "CPNS_to_PNS" from="CPNS" to="PNS" {
        requires {
             min_years_of_service 1 from="tmt_cpns"
             valid_effective_date "tmt_pns"
             document "sk_pns"
        }
        effects {
             update_rank_eligibility "true"
             notify "unit_kepegawaian"
        }
    }

    transition "PNS_to_Pensiun" from="PNS" to="Pensiun" {
        requires {
             min_age 58 from="tanggal_lahir"
        }
        effects {
             suspend_payroll "true"
             notify "taspen"
        }
    }

    transition "PNS_to_Cuti" from="PNS" to="Cuti" {
        requires {
            document "surat_cuti"
        }
        effects {
            suspend_payroll "true"
        }
    }

    transition "PNS_to_TugasBelajar" from="PNS" to="TugasBelajar" {
        requires {
            document "sk_tugas_belajar"
        }
        effects {
            notify "unit_pengembangan"
        }
    }

    transition "PNS_to_Nonaktif" from="PNS" to="Nonaktif" {
        requires {
            document "sk_pemberhentian"
        }
        effects {
            suspend_payroll "true"
            notify "bkn"
        }
    }

    transition "PNS_to_Pindah" from="PNS" to="Pindah" {
        requires {
            document "sk_lolos_butuh"
            min_years_of_service 2 from="tmt_cpns"
        }
        effects {
            suspend_payroll "true"
            notify "bkn"
        }
    }

    transition "Cuti_to_PNS" from="Cuti" to="PNS" {
        effects {
            suspend_payroll "false"
        }
    }

    transition "TugasBelajar_to_PNS" from="TugasBelajar" to="PNS" {
        effects {
            notify "unit_kepegawaian"
        }
    }
}

workflow "KGBWorkflow" for="PengajuanKGB" field="status" {
    state "Draft" initial="true"
    state "Diajukan"
    state "Disetujui"
    state "Ditolak"

    transition "Draft_to_Diajukan" from="Draft" to="Diajukan" {
        requires {
             check_kgb_eligibility "pegawai"
        }
    }

    transition "Diajukan_to_Disetujui" from="Diajukan" to="Disetujui" {
    }

    transition "Diajukan_to_Ditolak" from="Diajukan" to="Ditolak" {
    }
}

workflow "UsulanSLKSWorkflow" for="UsulanSLKS" field="status" {
    state "Draft" initial="true"
    state "Diajukan"
    state "Terverifikasi"
    state "Disetujui"
    state "Ditolak"

    transition "Submit" from="Draft" to="Diajukan" {
        allowed_roles "OperatorUnor"
        requires {
             is_set "file_pendukung"
        }
    }

    transition "Verify" from="Diajukan" to="Terverifikasi" {
        allowed_roles "VerifikatorEselon1"
    }

    transition "RejectByVerifier" from="Diajukan" to="Ditolak" {
        allowed_roles "VerifikatorEselon1"
    }

    transition "Approve" from="Terverifikasi" to="Disetujui" {
        allowed_roles "AdminSDMAO"
    }

    transition "RejectByAdmin" from="Terverifikasi" to="Ditolak" {
        allowed_roles "AdminSDMAO"
    }
}

workflow "UsulanTugasBelajarWorkflow" for="UsulanTugasBelajar" field="status" {
    state "Draft" initial="true"
    state "Diajukan"
    state "Disetujui"
    state "Ditolak"

    transition "Submit" from="Draft" to="Diajukan" {
        requires {
             is_set "file_surat"
        }
    }

    transition "Approve" from="Diajukan" to="Disetujui" {
        allowed_roles "AdminSDMAO"
    }

    transition "Reject" from="Diajukan" to="Ditolak" {
        allowed_roles "AdminSDMAO"
    }
}
